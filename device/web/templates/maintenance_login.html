{% extends "base.html" %}

{% block content %}
<div class="maintenance-login">
    <div class="card">
        <h2 class="card-title">维护模式</h2>
        <p style="color: #7f8c8d; margin-bottom: 30px;">请输入维护密码以访问系统管理功能</p>
        
        <form id="maintenance-form">
            <div class="form-group">
                <label class="form-label">维护密码</label>
                <input type="password" class="form-control" id="password" placeholder="请输入密码" required>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button type="submit" class="btn btn-primary btn-large">确认</button>
            </div>
        </form>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="{{ url_for('idle') }}" class="btn btn-warning">返回首页</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.maintenance-login {
    max-width: 400px;
    margin: 100px auto;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('maintenance-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const password = document.getElementById('password').value;
        
        if (!password) {
            showMessage('请输入维护密码', 'warning');
            return;
        }
        
        showLoading(true);
        
        fetch('/api/maintenance/auth', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ password: password })
        })
        .then(response => response.json())
        .then(data => {
            showLoading(false);
            if (data.success) {
                showMessage('验证成功，正在进入维护模式...', 'success');
                setTimeout(() => {
                    window.location.href = '/maintenance';
                }, 1000);
            } else {
                showMessage('密码错误，请重试', 'error');
                document.getElementById('password').value = '';
            }
        })
        .catch(error => {
            showLoading(false);
            console.error('Error:', error);
            showMessage('验证失败，请重试', 'error');
        });
    });
    
    // Focus on password input
    document.getElementById('password').focus();
</script>
{% endblock %}